// =========================================================================
//					대중교통 예약 시스템 - 배 
// =========================================================================

/* ************************************************************************
 * Filename		: ship_main.c
 * Description  : 대중교통 예약 시스템 - 배
 * Author		: JYC
 * History		: 2026-01-13
 * ************************************************************************/
 // ------------------------------------------------------------------------
 // Library   
 // ------------------------------------------------------------------------
#include<stdio.h>
#include "ship_header.h"

// -------------------------------------------------------------------------
// 선박 데이터 (임시 고정 데이터)
// -------------------------------------------------------------------------
// shipSowList 함수에서 출력하는 선박 목록 데이터 
// 정적 데이터로 구현(main.c에서는 접근 불가)
// 예약과 취소에서 같은 데이터를 사용해야 하므로 전역변수로 선언!!
static Ship ships[MAX_SHIP] =
{
	{"재영호",   "포항", "제주", "09:00", "10:30", 200, 1},
	{"힘찬호",   "부산", "제주", "10:00", "11:30", 180, 80},
	{"보경호",   "부산", "일본", "11:00", "13:00", 220, 200},
	{"영진호",   "통영", "제주", "13:00", "14:30", 220, 200},
	{"레전드호", "통영", "일본", "15:00", "17:15", 150, 0}
};

static int shipCount = 5;
static Reservation1 reservations[MAX_RES];
static int reservationCount = 0;

// -------------------------------------------------------------------------
// User Define Function
// -------------------------------------------------------------------------
// 함수이름 : runShipSystem 
// 함수기능 : 선박 예약 시스템 전체 흐름 제어
//			  선박 목록 출력 
//			  메뉴 출력 및 입력 처리
//			  예약 / 조회/ 수정 / 취소 기능 호출
// 매개변수 : x 
// 결과반환 : x
// -------------------------------------------------------------------------
// 현재는 문자가 들어오면 무한루프를 돌게 됨 -> 수정 필요 **********************
void runShipSystem(void)
{
	int menu = -1;

	printf(" ------------------------------------ \n");
	printf("          선박 예약 시스템            \n");
	printf(" ------------------------------------ \n");

	showShipList();
	while (1)
	{
		printf("\n");
		printf(" [메뉴 선택] \n");
		printf(" 1. 예약하기 \n");
		printf(" 2. 예약취소 \n");
		//printf(" 3. 예약수정 \n");
		printf(" 3. 예약조회 \n");
		printf(" 0. 종료하기 \n");
		printf(" ------------------------------------ \n");
		printf(" 선택 : ");
		//scanf("%d", &menu); // 여기서 문자를 입력하면 무한루프를 돌게 되는데
							// 분명 설명을 들었던 것 같은데 몰라서 지피티 활용.. 
		if (scanf("%d", &menu) != 1)
		{
			printf("잘못된 입력입니다. 숫자만 입력해주세요.\n");
			while (getchar() != '\n'); // 개행 문자까지 읽어서 버퍼 비우기
			continue; // 다시 메뉴 선택으로 돌아감
		}
		printf("\n");
		switch (menu)
		{
		default:
			break;
		case 1:
			reserveTicket();
			break;
		case 2:
			cancelReservation();
			break;
			//case 3:
			//	updateReservation();
			//	break;
		case 3:
			showReservations();
			break;
		case 0:
			printf("선박 예약 시스템을 종료합니다.\n");
			return;
		}
		if (menu == 0)
			break;
	}
}

// -------------------------------------------------------------------------
// 함수이름 : showShipList 
// 함수기능 : 운항 중인 선박 목록 출력
//			  배 이름
//			  출발지 -> 도착지 
//			  출발 시간 -> 도착 시간
//			  총 좌석 수 -> 남은 좌석 수 
// 매개변수 : x 
// 결과반환 : x
// -------------------------------------------------------------------------
void showShipList(void)
{
	// TODO: 추후 Ship 구조체 배열 기반 출력으로 변경 예정
	//printf(" [운항 중인 선박 목록] \n");
	//printf(" ┌---------------------------------------------------------------------------------------------┐ \n");
	//printf(" │ 선박명   |   출발지    |    도착지   |   출발시간  |   도착시간  |  총좌석수  |  남은좌석수 │\n");
	//printf(" │---------------------------------------------------------------------------------------------│ \n");
	//printf(" │ 재영호   |   포항      |    제주     |   09:00     |   10:30     |    200     |     1       │\n");
	//printf(" │ 힘찬호   |   부산      |    제주     |   10:00     |   11:30     |    180     |     80      │\n");
	//printf(" │ 보경호   |   부산      |    일본     |   11:00     |   13:00     |    220     |     200     │\n");
	//printf(" │ 영진호   |   통영      |    제주     |   13:00     |   14:30     |    220     |     200     │\n");
	//printf(" │ 레전드호 |   통영      |    일본     |   15:00     |   17:15     |    150     |     0       │\n");
	//printf(" └---------------------------------------------------------------------------------------------┘ \n");

	// 배열 기반 출력으로 변경 ↓
	int i;

	printf(" [운항 중인 선박 목록] \n");
	printf(" ┌---------------------------------------------------------------------------------------------┐ \n");
	printf(" │ 번호 | 선박명   | 출발지 | 도착지 | 출발시간 | 도착시간 | 총좌석수 | 남은좌석수 │\n");
	printf(" │---------------------------------------------------------------------------------------------│ \n");

	for (i = 0; i < shipCount; i++)
	{
		printf(" │  %d   | %-8s | %-6s | %-6s |  %-7s |  %-7s |   %4d   |    %4d    │\n",
			i + 1,
			ships[i].name,
			ships[i].from,
			ships[i].to,
			ships[i].departTime,
			ships[i].arriveTime,
			ships[i].totalSeat,
			ships[i].remainSeat);
	}

	printf(" └---------------------------------------------------------------------------------------------┘ \n");

}

// -------------------------------------------------------------------------
// 함수이름 : showReservations
// 함수기능 : 현재 예약된 목록 출력
//			  예약자 이름
//			  예약한 선박 정보
//			  출발지 -> 도착지
//		      출발 시간
// 매개변수 : x
// 결과반환 : x
// -------------------------------------------------------------------------
void showReservations(void)
{
	int i;
	int idx;

	if (reservationCount == 0)
	{
		printf("\n[예약 내역이 없습니다]\n");
		return;
	}

	printf("\n[예약 목록]\n");
	printf(" ┌--------------------------------------------------------------------------------─────┐\n");
	printf(" │ 번호 | 예약자   | 선박명   | 출발지 | 도착지 | 출발시간 | 도착시간 │\n");
	printf(" │-------------------------------------------------------------------------------------│\n");

	for (i = 0; i < reservationCount; i++)
	{
		idx = reservations[i].shipIndex;  // Ship 배열 인덱스

		// 방어 코드 (혹시 모를 데이터 깨짐 대비)
		if (idx < 0 || idx >= shipCount)
			continue;

		printf(" │  %2d  | %-8s | %-8s | %-6s | %-6s |  %-7s |  %-7s │\n",
			i + 1,
			reservations[i].user,
			ships[idx].name,
			ships[idx].from,
			ships[idx].to,
			ships[idx].departTime,
			ships[idx].arriveTime);
	}

	printf(" └--------------------------------------------------------------------------------─────┘\n");
}



// -------------------------------------------------------------------------
// 함수이름 : reserveTicket
// 함수기능 : 선박 예약 처리
//			  선박 목록 출력 / 선박 선택 / 예약자 입력 
//			  / 좌석 수 감소 / 예약 정보 저장 
// 매개변수 : x
// 결과반환 : x
// -------------------------------------------------------------------------
void reserveTicket(void)
{
	printf("\n[예약 처리 ]\n");

	int shipNo;
	Reservation1 r;

	// 1. 선박 목록 출력 
	showShipList();

	// 2. 선박 선택
	printf("예약할 선박 번호 선택 ( 1 ~ %d, 0: 뒤로가기 ) : ", shipCount);
	scanf("%d", &shipNo);
	if (shipNo == 0)
	{
		printf("예약을 취소하고 이전 메뉴로 돌아갑니다.\n");
		return;
	}

	// 번호 보정 ( 배열 인덱스용 )
	shipNo -= 1;

	// 3. 유효성 검사 (중요)
	if (shipNo < 0 || shipNo >= shipCount)
	{
		printf("잘못된 선박 번호입니다. ( 선박 번호 : 1~ %d)\n", shipCount);
		return;
	}

	if (ships[shipNo].remainSeat <= 0)
	{
		printf("해당 선박은 잔여 좌석이 없습니다. \n");
		return;
	}

	if (reservationCount >= MAX_RES)
	{
		printf("예약 가능 수를 초과했습니다.\n");
		return;
	}

	// 4. 예약자 이름 입력 
	printf("예약자 이름 입력 : ");
	scanf("%s", r.user);

	// 5. 예약자 정보 저장 
	r.shipIndex = shipNo;
	reservations[reservationCount] = r;
	reservationCount++;

	// 6. 좌석 수 감소
	ships[shipNo].remainSeat--;

	// 7. 예약 완료 메시지 출력
	printf("예약이 완료되었습니다~! ♬  \n");
	printf("예약자: %s\n", r.user);
	printf("선박명: %s (%s → %s)\n",
		ships[shipNo].name,
		ships[shipNo].from,
		ships[shipNo].to);
	printf("남은 좌석 수: %d\n", ships[shipNo].remainSeat);


}


// -------------------------------------------------------------------------
// 함수이름 : cancelReservation
// 함수기능 : 예약 취소 처리
//			  예약 목록 출력 / 취소할 예약 선택
//			  좌석 수 복구 / 예약 정보 삭제
// 매개변수 : x
// 결과반환 : x
// -------------------------------------------------------------------------
void cancelReservation(void)
{
	int sel;
	int i;
	int shipIdx;

	// 1. 예약 체크 
	if (reservationCount == 0)
	{
		printf("[ 취소 가능한 예약이 없습니다 ! ] \n");
		return;
	}
	// 2. 예약 목록 출력
	showReservations();

	// 3. 취소할 예약 선택
	printf("취소할 예약 번호 선택 ( 1 ~ %d, 0: 뒤로가기 ) : ", reservationCount);
	scanf("%d", &sel);

	if (sel == 0)
	{
		printf("취소를 취소하고 이전 메뉴로 돌아갑니다.\n");
		return;
	}
	// 번호 보정 ( 배열 인덱스용 )
	sel -= 1;

	// 4. 유효성 검사 (중요)
	if (sel < 0 || sel >= reservationCount)
	{
		printf("잘못된 예약 번호입니다. ( 예약 번호 : 1 ~ %d ) \n", reservationCount);
		return;
	}
	// 6. 좌석 수 복구
	shipIdx = reservations[sel].shipIndex;
	ships[shipIdx].remainSeat++;

	// 7. 예약 정보 삭제 (뒤의 데이터를 앞으로 한 칸씩 당기기) 흠 .. ㅇ.. ㅇ.. ㅇ.. ㅇ 지퓨ㅣ티가 도와줫는데  이해하고 넘어가기 
	for (i = sel; i < reservationCount - 1; i++)
	{
		reservations[i] = reservations[i + 1];
	}
	reservationCount--;

	// 8. 취소 완료 메시지 출력
	printf("예약이 취소되었습니다~ \n");
}


// -------------------------------------------------------------------------
// 함수이름 : updateReservation
// 함수기능 : 예약 정보 수정
//			  기존 예약 선택 / 기존  예약 취소 처리
//			  새로운 운항정보 선택 / 예약 정보 갱신
// 매개변수 : x
// 결과반환 : x
// -------------------------------------------------------------------------
// 근데 수정이라는게 결국 cancel + Ticket 과정인데 굳이 필요할까....흠 
//void updateReservation(void)
//{
//	printf("\n[예약 수정 - 임시]\n");
//	
//}



